(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=e.n(t);const r=flarum.core.compat["common/components/TextEditor"];var a=e.n(r);function o(e){return e&&e.attrs&&e.attrs.composer&&e.attrs.composer.editor&&e.attrs.composer.editor.el||null}function i(e){var t=o(e);if(!t)return null;var n=t.closest(".Composer");if(!n)return null;var r=n.querySelector(".Composer-controls");if(!r)return null;var a=r.querySelector("li.item-magicread-counter"),i=null;if(a)i=a.querySelector(".MagicRead-CharCounter");else{var c=function(){var e=document.createElement("li");e.className="item-magicread-counter";var t=document.createElement("span");return t.className="MagicRead-CharCounter",t.textContent="0",t.setAttribute("aria-live","polite"),e.appendChild(t),{li:e,span:t}}();a=c.li,i=c.span,r.insertAdjacentElement("afterbegin",a)}return i}var c=null,u=null,s=null,l=null,d=!1;function m(){return!!document.querySelector(".DiscussionPage")}function p(){return window.matchMedia("(max-width: 800px)").matches}function v(){return!1!==n().forum.attribute("magicread_enable_pagination")}function f(){if(!n().current)return null;var e=null;if("function"==typeof n().current.get&&(e=n().current.get("stream")),!e&&n().current&&n().current.stream&&(e=n().current.stream),!e){var t=document.querySelector(".DiscussionPage .PostStream");t&&t.__stream&&(e=t.__stream)}return e||null}function g(){var e=n().current&&"function"==typeof n().current.get&&n().current.get("discussion")||null,t=e&&"function"==typeof e.commentCount?e.commentCount():0,r=Math.ceil((t||0)/20);return r>0?r:1}function h(e,t,n){var r=function(e){var t=parseInt(e,10);return(isNaN(t)||t<0)&&(t=0),String(t).length}(t)+(n||0);e.style.width=r+"ch"}function y(){if(m()&&!p())if(v()){var e=function(){var e=document.querySelector(".DiscussionPage .PostStreamScrubber");if(!e)return null;var t=e.parentElement?e.parentElement.querySelector(":scope > .MagicRead-TimelinePagerHost"):null;return t||((t=document.createElement("div")).className="MagicRead-TimelinePagerHost",e.insertAdjacentElement("afterend",t)),t}();if(e){c=function(e){e.textContent="";var t=document.createElement("div");t.className="MagicRead-TimelinePager";var n=document.createElement("input");n.type="text",n.inputMode="numeric",n.autocomplete="off",n.className="MagicRead-Input";var r=document.createElement("span");r.className="MagicRead-Sep",r.textContent="/";var a=document.createElement("span");function o(){var e=n.value;e||(e="1"),function(e){var t=g(),n=parseInt(e,10);(!n||n<1)&&(n=1),n>t&&(n=t);var r=f(),a=20*(n-1),o=a+1;r&&"function"==typeof r.goToNumber?r.goToNumber(o):r&&"function"==typeof r.goToIndex&&r.goToIndex(a)}(e)}function i(){var e,t,r,o=(t=(e=f())&&"number"==typeof e.index?e.index:0,(r=Math.floor(t/20)+1)>0?r:1),i=g();n.value=String(o),a.textContent=String(i),h(n,o,.5),h(a,i,.5)}return a.className="MagicRead-Total",t.appendChild(n),t.appendChild(r),t.appendChild(a),e.appendChild(t),n.addEventListener("input",function(){var e=n.value.replace(/[^\d]/g,"");n.value=e,h(n,e||0,.5)}),n.addEventListener("keydown",function(e){"Enter"===e.key&&o()}),n.addEventListener("blur",o),i(),i}(e);var t=document.querySelector(".DiscussionPage .PostStream");t&&(u&&u.disconnect(),(u=new MutationObserver(function(){c&&c()})).observe(t,{childList:!0,subtree:!0})),d||(window.addEventListener("popstate",C,{passive:!0}),window.addEventListener("hashchange",C,{passive:!0}),window.addEventListener("resize",R,{passive:!0}),d=!0)}}else E()}function E(){u&&(u.disconnect(),u=null);var e=document.querySelector(".MagicRead-TimelinePagerHost");e&&e.parentNode&&e.parentNode.removeChild(e),c=null}function C(){s&&clearTimeout(s),s=setTimeout(function(){m()&&!p()&&v()?(y(),c&&c()):E()},60)}function R(){l&&clearTimeout(l),l=setTimeout(function(){C()},120)}n().initializers.add("capybash-magicread",function(){function e(){return!1!==n().forum.attribute("magicread_enable_counter")}var t=a().prototype.oncreate;a().prototype.oncreate=function(n){if(t&&t.call(this,n),e()){var r=i(this);this.magicReadCounterEl=r;var a=this;this.magicReadUpdate=function(){var e=o(a),t=e&&"string"==typeof e.value?e.value.length:0;a.magicReadCounterEl&&(a.magicReadCounterEl.textContent=String(t))};var c=o(this);c&&(c.addEventListener("input",this.magicReadUpdate),this.magicReadUpdate())}};var r=a().prototype.onupdate;a().prototype.onupdate=function(t){r&&r.call(this,t),e()&&(this.magicReadCounterEl&&document.body.contains(this.magicReadCounterEl)||(this.magicReadCounterEl=i(this),this.magicReadUpdate&&this.magicReadUpdate()))};var c=a().prototype.onremove;a().prototype.onremove=function(e){try{var t=o(this);t&&this.magicReadUpdate&&t.removeEventListener("input",this.magicReadUpdate);var n=this.magicReadCounterEl?this.magicReadCounterEl.closest(".item-magicread-counter"):null;n&&n.parentNode&&n.parentNode.removeChild(n)}catch(e){}c&&c.call(this,e)},document.addEventListener("DOMContentLoaded",function(){C()}),setTimeout(C,0)})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map