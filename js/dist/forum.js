(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var n=e.n(t);const r=flarum.core.compat["common/components/TextEditor"];var a=e.n(r);const o=flarum.core.compat["forum/components/DiscussionPage"];var i=e.n(o);const u=flarum.core.compat["common/extend"];function c(e){var t;return(null==e||null==(t=e.attrs)||null==(t=t.composer)||null==(t=t.editor)?void 0:t.el)||null}function l(e){var t=c(e);if(!t)return null;var n=t.closest(".Composer");if(!n)return null;var r=n.querySelector(".Composer-controls");if(!r)return null;var a=r.querySelector("li.item-magicread-counter"),o=null;if(a)o=a.querySelector(".MagicRead-CharCounter");else{var i=function(){var e=document.createElement("li");e.className="item-magicread-counter";var t=document.createElement("span");return t.className="MagicRead-CharCounter",t.textContent="0",t.setAttribute("aria-live","polite"),e.appendChild(t),{li:e,span:t}}();a=i.li,o=i.span,r.insertAdjacentElement("afterbegin",a)}return o}var s=null,d=null,m=null,p=null,v=!1;function f(){return!!document.querySelector(".DiscussionPage")}function g(){return window.matchMedia("(max-width: 800px)").matches}function h(){return!1!==n().forum.attribute("magicread_enable_pagination")}function y(){if(!n().current)return null;var e=null;if("function"==typeof n().current.get&&(e=n().current.get("stream")),!e&&n().current.stream&&(e=n().current.stream),!e){var t=document.querySelector(".DiscussionPage .PostStream");t&&t.__stream&&(e=t.__stream)}return e||null}function E(){var e=n().current&&"function"==typeof n().current.get&&n().current.get("discussion")||null,t=e&&"function"==typeof e.commentCount?e.commentCount():0,r=Math.ceil((t||0)/20);return r>0?r:1}function w(e,t,n){void 0===n&&(n=0);var r=function(e){var t=parseInt(String(e),10);return(isNaN(t)||t<0)&&(t=0),String(t).length}(t)+n;e.setAttribute("style","width:"+r+"ch")}function C(){if(f()&&!g()&&h()){var e=function(){var e,t=document.querySelector(".DiscussionPage .PostStreamScrubber");if(!t)return null;var n=null==(e=t.parentElement)?void 0:e.querySelector(":scope > .MagicRead-TimelinePagerHost");return n||((n=document.createElement("div")).className="MagicRead-TimelinePagerHost",t.insertAdjacentElement("afterend",n)),n}();if(e){s=function(e){e.textContent="";var t=document.createElement("div");t.className="MagicRead-TimelinePager";var n=document.createElement("input");n.type="text",n.inputMode="numeric",n.autocomplete="off",n.className="MagicRead-Input";var r=document.createElement("span");r.className="MagicRead-Sep",r.textContent="/";var a=document.createElement("span");function o(){var e=n.value;e||(e="1"),function(e){var t=E(),n=parseInt(String(e),10);(!n||n<1)&&(n=1),n>t&&(n=t);var r=y(),a=20*(n-1),o=a+1;null!=r&&r.goToNumber?r.goToNumber(o):null!=r&&r.goToIndex&&r.goToIndex(a)}(e)}function i(){var e,t,r,o=(t=(e=y())&&"number"==typeof e.index?e.index:0,(r=Math.floor(t/20)+1)>0?r:1),i=E();n.value=String(o),a.textContent=String(i),w(n,o,.5),w(a,i,.5)}return a.className="MagicRead-Total",t.appendChild(n),t.appendChild(r),t.appendChild(a),e.appendChild(t),n.addEventListener("input",function(){var e=n.value.replace(/[^\d]/g,"");n.value=e,w(n,e||0,.5)}),n.addEventListener("keydown",function(e){"Enter"===e.key&&o()}),n.addEventListener("blur",o),i(),i}(e);var t=document.querySelector(".DiscussionPage .PostStream");t&&(d&&d.disconnect(),(d=new MutationObserver(function(){null==s||s()})).observe(t,{childList:!0,subtree:!0})),v||(window.addEventListener("popstate",b,{passive:!0}),window.addEventListener("hashchange",b,{passive:!0}),window.addEventListener("resize",S,{passive:!0}),v=!0)}}else R()}function R(){d&&(d.disconnect(),d=null);var e=document.querySelector(".MagicRead-TimelinePagerHost");null!=e&&e.parentNode&&e.parentNode.removeChild(e),s=null}function b(){m&&window.clearTimeout(m),m=window.setTimeout(function(){f()&&!g()&&h()?(C(),null==s||s()):R()},60)}function S(){p&&window.clearTimeout(p),p=window.setTimeout(function(){return b()},120)}n().initializers.add("capybash-magicread",function(){function e(){return!1!==n().forum.attribute("magicread_enable_counter")}var t=a().prototype.oncreate;a().prototype.oncreate=function(n){var r=this;if(t&&t.call(this,n),e()){this.magicReadCounterEl=l(this),this.magicReadUpdate=function(){var e,t,n=c(r),a=null!=(e=null==n||null==(t=n.value)?void 0:t.length)?e:0;r.magicReadCounterEl&&(r.magicReadCounterEl.textContent=String(a))};var a=c(this);a&&(a.addEventListener("input",this.magicReadUpdate),this.magicReadUpdate())}};var r=a().prototype.onupdate;a().prototype.onupdate=function(t){var n;r&&r.call(this,t),e()&&(this.magicReadCounterEl&&document.body.contains(this.magicReadCounterEl)||(this.magicReadCounterEl=l(this),null==(n=this.magicReadUpdate)||n.call(this)))};var o=a().prototype.onremove;a().prototype.onremove=function(e){try{var t,n=c(this);n&&this.magicReadUpdate&&n.removeEventListener("input",this.magicReadUpdate);var r=null==(t=this.magicReadCounterEl)?void 0:t.closest(".item-magicread-counter");null!=r&&r.parentNode&&r.parentNode.removeChild(r)}catch(e){}o&&o.call(this,e)},(0,u.extend)(i().prototype,"oncreate",function(){setTimeout(b,0)}),(0,u.extend)(i().prototype,"onupdate",function(){s?s():b()}),(0,u.extend)(i().prototype,"onremove",function(){R()}),window.addEventListener("popstate",b,{passive:!0}),window.addEventListener("hashchange",b,{passive:!0}),window.addEventListener("resize",S,{passive:!0})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map