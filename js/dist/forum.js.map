{"version":3,"sources":["webpack://@capybash-magicread/webpack/bootstrap","webpack://@capybash-magicread/external \"flarum.core.compat['forum/app']\"","webpack://@capybash-magicread/external \"flarum.core.compat['common/components/TextEditor']\"","webpack://@capybash-magicread/./src/forum/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","flarum","core","compat","getTextarea","ctx","attrs","composer","editor","el","mountCounterLeft","ta","closest","controls","querySelector","li","span","nodes","document","createElement","className","textContent","setAttribute","appendChild","createCounterLi","insertAdjacentElement","pagerUpdate","mo","routeTimer","resizeTimer","winListenersBound","isDiscussionPage","isMobile","window","matchMedia","matches","paginationEnabled","app","forum","attribute","getStream","current","stream","__stream","totalPages","total","commentCount","pages","Math","ceil","fitWidth","padCh","ch","v","parseInt","isNaN","String","length","digits","style","width","buildPagerDom","host","wrap","input","type","inputMode","autocomplete","sep","commit","all","num","byIndex","byNumber","goToNumber","goToIndex","gotoPage","sync","idx","cur","index","floor","addEventListener","replace","e","mountPager","scrubber","parentElement","ensurePagerHost","streamNode","disconnect","MutationObserver","observe","childList","subtree","handleRouteChange","passive","handleResize","unmountPager","parentNode","removeChild","clearTimeout","setTimeout","initializers","add","counterEnabled","oldCreate","TextEditor","oncreate","vnode","this","magicReadCounterEl","self","magicReadUpdate","val","oldUpdate","onupdate","body","contains","oldRemove","onremove","removeEventListener"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 5);\n","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['common/components/TextEditor'];","import app from 'flarum/forum/app';\nimport TextEditor from 'flarum/common/components/TextEditor';\n\nfunction getTextarea(ctx) {\n  if (!ctx || !ctx.attrs || !ctx.attrs.composer || !ctx.attrs.composer.editor) return null;\n  return ctx.attrs.composer.editor.el || null;\n}\n\nfunction createCounterLi() {\n  var li = document.createElement('li');\n  li.className = 'item-magicread-counter';\n  var span = document.createElement('span');\n  span.className = 'MagicRead-CharCounter';\n  span.textContent = '0';\n  span.setAttribute('aria-live', 'polite');\n  li.appendChild(span);\n  return { li: li, span: span };\n}\n\nfunction mountCounterLeft(ctx) {\n  var ta = getTextarea(ctx);\n  if (!ta) return null;\n  var composer = ta.closest('.Composer');\n  if (!composer) return null;\n  var controls = composer.querySelector('.Composer-controls');\n  if (!controls) return null;\n  var li = controls.querySelector('li.item-magicread-counter');\n  var span = null;\n  if (li) {\n    span = li.querySelector('.MagicRead-CharCounter');\n  } else {\n    var nodes = createCounterLi();\n    li = nodes.li;\n    span = nodes.span;\n    controls.insertAdjacentElement('afterbegin', li);\n  }\n  return span;\n}\n\nvar PER_PAGE = 20;\nvar pagerUpdate = null;\nvar mo = null;\nvar routeTimer = null;\nvar resizeTimer = null;\nvar winListenersBound = false;\n\nfunction isDiscussionPage() {\n  return !!document.querySelector('.DiscussionPage');\n}\n\nfunction isMobile() {\n  return window.matchMedia('(max-width: 800px)').matches;\n}\n\nfunction paginationEnabled() {\n  var v = app.forum.attribute('magicread_enable_pagination');\n  return v !== false;\n}\n\nfunction getDiscussion() {\n  if (!app.current) return null;\n  if (typeof app.current.get === 'function') return app.current.get('discussion') || null;\n  return null;\n}\n\nfunction getStream() {\n  if (!app.current) return null;\n  var s = null;\n  if (typeof app.current.get === 'function') s = app.current.get('stream');\n  if (!s && app.current && app.current.stream) s = app.current.stream;\n  if (!s) {\n    var el = document.querySelector('.DiscussionPage .PostStream');\n    if (el && el.__stream) s = el.__stream;\n  }\n  return s || null;\n}\n\nfunction totalPages() {\n  var d = getDiscussion();\n  var total = d && typeof d.commentCount === 'function' ? d.commentCount() : 0;\n  var pages = Math.ceil((total || 0) / PER_PAGE);\n  return pages > 0 ? pages : 1;\n}\n\nfunction currentPage() {\n  var s = getStream();\n  var idx = s && typeof s.index === 'number' ? s.index : 0;\n  var p = Math.floor(idx / PER_PAGE) + 1;\n  return p > 0 ? p : 1;\n}\n\nfunction gotoPage(n) {\n  var all = totalPages();\n  var num = parseInt(n, 10);\n  if (!num || num < 1) num = 1;\n  if (num > all) num = all;\n  var s = getStream();\n  var byIndex = (num - 1) * PER_PAGE;\n  var byNumber = byIndex + 1;\n  if (s && typeof s.goToNumber === 'function') {\n    s.goToNumber(byNumber);\n  } else if (s && typeof s.goToIndex === 'function') {\n    s.goToIndex(byIndex);\n  }\n}\n\nfunction ensurePagerHost() {\n  var scrubber = document.querySelector('.DiscussionPage .PostStreamScrubber');\n  if (!scrubber) return null;\n  var host = scrubber.parentElement ? scrubber.parentElement.querySelector(':scope > .MagicRead-TimelinePagerHost') : null;\n  if (!host) {\n    host = document.createElement('div');\n    host.className = 'MagicRead-TimelinePagerHost';\n    scrubber.insertAdjacentElement('afterend', host);\n  }\n  return host;\n}\n\nfunction digits(n) {\n  var v = parseInt(n, 10);\n  if (isNaN(v) || v < 0) v = 0;\n  return String(v).length;\n}\n\nfunction fitWidth(el, n, padCh) {\n  var ch = digits(n) + (padCh || 0);\n  el.style.width = ch + 'ch';\n}\n\nfunction buildPagerDom(host) {\n  host.textContent = '';\n  var wrap = document.createElement('div');\n  wrap.className = 'MagicRead-TimelinePager';\n  var input = document.createElement('input');\n  input.type = 'text';\n  input.inputMode = 'numeric';\n  input.autocomplete = 'off';\n  input.className = 'MagicRead-Input';\n  var sep = document.createElement('span');\n  sep.className = 'MagicRead-Sep';\n  sep.textContent = '/';\n  var total = document.createElement('span');\n  total.className = 'MagicRead-Total';\n  wrap.appendChild(input);\n  wrap.appendChild(sep);\n  wrap.appendChild(total);\n  host.appendChild(wrap);\n  function sanitize() {\n    var v = input.value.replace(/[^\\d]/g, '');\n    input.value = v;\n    fitWidth(input, v || 0, 0.5);\n  }\n  function commit() {\n    var v = input.value;\n    if (!v) v = '1';\n    gotoPage(v);\n  }\n  input.addEventListener('input', sanitize);\n  input.addEventListener('keydown', function (e) {\n    if (e.key === 'Enter') commit();\n  });\n  input.addEventListener('blur', commit);\n  function sync() {\n    var cur = currentPage();\n    var all = totalPages();\n    input.value = String(cur);\n    total.textContent = String(all);\n    fitWidth(input, cur, 0.5);\n    fitWidth(total, all, 0.5);\n  }\n  sync();\n  return sync;\n}\n\nfunction mountPager() {\n  if (!isDiscussionPage()) return;\n  if (isMobile()) return;\n  if (!paginationEnabled()) {\n    unmountPager();\n    return;\n  }\n  var host = ensurePagerHost();\n  if (!host) return;\n  pagerUpdate = buildPagerDom(host);\n  var streamNode = document.querySelector('.DiscussionPage .PostStream');\n  if (streamNode) {\n    if (mo) mo.disconnect();\n    mo = new MutationObserver(function () {\n      if (pagerUpdate) pagerUpdate();\n    });\n    mo.observe(streamNode, { childList: true, subtree: true });\n  }\n  if (!winListenersBound) {\n    window.addEventListener('popstate', handleRouteChange, { passive: true });\n    window.addEventListener('hashchange', handleRouteChange, { passive: true });\n    window.addEventListener('resize', handleResize, { passive: true });\n    winListenersBound = true;\n  }\n}\n\nfunction unmountPager() {\n  if (mo) {\n    mo.disconnect();\n    mo = null;\n  }\n  var host = document.querySelector('.MagicRead-TimelinePagerHost');\n  if (host && host.parentNode) host.parentNode.removeChild(host);\n  pagerUpdate = null;\n}\n\nfunction handleRouteChange() {\n  if (routeTimer) clearTimeout(routeTimer);\n  routeTimer = setTimeout(function () {\n    if (!isDiscussionPage() || isMobile() || !paginationEnabled()) {\n      unmountPager();\n    } else {\n      mountPager();\n      if (pagerUpdate) pagerUpdate();\n    }\n  }, 60);\n}\n\nfunction handleResize() {\n  if (resizeTimer) clearTimeout(resizeTimer);\n  resizeTimer = setTimeout(function () {\n    handleRouteChange();\n  }, 120);\n}\n\napp.initializers.add('capybash-magicread', function () {\n  function counterEnabled() {\n    var v = app.forum.attribute('magicread_enable_counter');\n    return v !== false;\n  }\n\n  var oldCreate = TextEditor.prototype.oncreate;\n  TextEditor.prototype.oncreate = function (vnode) {\n    if (oldCreate) oldCreate.call(this, vnode);\n    if (!counterEnabled()) return;\n    var span = mountCounterLeft(this);\n    this.magicReadCounterEl = span;\n    var self = this;\n    this.magicReadUpdate = function () {\n      var ta = getTextarea(self);\n      var val = ta && typeof ta.value === 'string' ? ta.value.length : 0;\n      if (self.magicReadCounterEl) self.magicReadCounterEl.textContent = String(val);\n    };\n    var ta = getTextarea(this);\n    if (ta) {\n      ta.addEventListener('input', this.magicReadUpdate);\n      this.magicReadUpdate();\n    }\n  };\n\n  var oldUpdate = TextEditor.prototype.onupdate;\n  TextEditor.prototype.onupdate = function (vnode) {\n    if (oldUpdate) oldUpdate.call(this, vnode);\n    if (!counterEnabled()) return;\n    if (!this.magicReadCounterEl || !document.body.contains(this.magicReadCounterEl)) {\n      this.magicReadCounterEl = mountCounterLeft(this);\n      if (this.magicReadUpdate) this.magicReadUpdate();\n    }\n  };\n\n  var oldRemove = TextEditor.prototype.onremove;\n  TextEditor.prototype.onremove = function (vnode) {\n    try {\n      var ta = getTextarea(this);\n      if (ta && this.magicReadUpdate) ta.removeEventListener('input', this.magicReadUpdate);\n      var li = this.magicReadCounterEl ? this.magicReadCounterEl.closest('.item-magicread-counter') : null;\n      if (li && li.parentNode) li.parentNode.removeChild(li);\n    } catch (e) {}\n    if (oldRemove) oldRemove.call(this, vnode);\n  };\n\n  document.addEventListener('DOMContentLoaded', function () {\n    handleRouteChange();\n  });\n  setTimeout(handleRouteChange, 0);\n});"],"sourceRoot":""}