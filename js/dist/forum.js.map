{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@capybash/magicread/webpack/bootstrap","webpack://@capybash/magicread/webpack/runtime/compat get default export","webpack://@capybash/magicread/webpack/runtime/define property getters","webpack://@capybash/magicread/webpack/runtime/hasOwnProperty shorthand","webpack://@capybash/magicread/external root \"flarum.core.compat['forum/app']\"","webpack://@capybash/magicread/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@capybash/magicread/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@capybash/magicread/external root \"flarum.core.compat['common/extend']\"","webpack://@capybash/magicread/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","import app from 'flarum/forum/app';\nimport TextEditor from 'flarum/common/components/TextEditor';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport { extend } from 'flarum/common/extend';\n\ninterface MagicReadEditor extends TextEditor {\n  magicReadCounterEl?: HTMLElement | null;\n  magicReadUpdate?: () => void;\n  attrs: {\n    composer?: {\n      editor?: {\n        el?: HTMLTextAreaElement;\n      };\n    };\n  };\n}\n\nfunction getTextarea(ctx: MagicReadEditor): HTMLTextAreaElement | null {\n  return ctx?.attrs?.composer?.editor?.el || null;\n}\n\nfunction createCounterLi(): { li: HTMLLIElement; span: HTMLSpanElement } {\n  const li = document.createElement('li');\n  li.className = 'item-magicread-counter';\n  const span = document.createElement('span');\n  span.className = 'MagicRead-CharCounter';\n  span.textContent = '0';\n  span.setAttribute('aria-live', 'polite');\n  li.appendChild(span);\n  return { li, span };\n}\n\nfunction mountCounterLeft(ctx: MagicReadEditor): HTMLSpanElement | null {\n  const ta = getTextarea(ctx);\n  if (!ta) return null;\n\n  const composer = ta.closest('.Composer');\n  if (!composer) return null;\n\n  const controls = composer.querySelector('.Composer-controls');\n  if (!controls) return null;\n\n  let li = controls.querySelector('li.item-magicread-counter') as HTMLLIElement | null;\n  let span: HTMLSpanElement | null = null;\n\n  if (li) {\n    span = li.querySelector('.MagicRead-CharCounter');\n  } else {\n    const nodes = createCounterLi();\n    li = nodes.li;\n    span = nodes.span;\n    controls.insertAdjacentElement('afterbegin', li);\n  }\n  return span;\n}\n\nlet PER_PAGE = 20;\nlet pagerUpdate: (() => void) | null = null;\nlet mo: MutationObserver | null = null;\nlet routeTimer: number | null = null;\nlet resizeTimer: number | null = null;\nlet winListenersBound = false;\n\nfunction isDiscussionPage(): boolean {\n  return !!document.querySelector('.DiscussionPage');\n}\n\nfunction isMobile(): boolean {\n  return window.matchMedia('(max-width: 800px)').matches;\n}\n\nfunction paginationEnabled(): boolean {\n  const v = app.forum.attribute('magicread_enable_pagination');\n  return v !== false;\n}\n\nfunction getDiscussion(): any | null {\n  if (!app.current) return null;\n  if (typeof (app.current as any).get === 'function') return (app.current as any).get('discussion') || null;\n  return null;\n}\n\nfunction getStream(): any | null {\n  if (!app.current) return null;\n  let s: any | null = null;\n  if (typeof (app.current as any).get === 'function') s = (app.current as any).get('stream');\n  if (!s && (app.current as any).stream) s = (app.current as any).stream;\n\n  if (!s) {\n    const el = document.querySelector('.DiscussionPage .PostStream') as any;\n    if (el && el.__stream) s = el.__stream;\n  }\n  return s || null;\n}\n\nfunction totalPages(): number {\n  const d = getDiscussion();\n  const total = d && typeof d.commentCount === 'function' ? d.commentCount() : 0;\n  const pages = Math.ceil((total || 0) / PER_PAGE);\n  return pages > 0 ? pages : 1;\n}\n\nfunction currentPage(): number {\n  const s = getStream();\n  const idx = s && typeof s.index === 'number' ? s.index : 0;\n  const p = Math.floor(idx / PER_PAGE) + 1;\n  return p > 0 ? p : 1;\n}\n\nfunction gotoPage(n: string | number): void {\n  const all = totalPages();\n  let num = parseInt(String(n), 10);\n  if (!num || num < 1) num = 1;\n  if (num > all) num = all;\n\n  const s = getStream();\n  const byIndex = (num - 1) * PER_PAGE;\n  const byNumber = byIndex + 1;\n\n  if (s?.goToNumber) s.goToNumber(byNumber);\n  else if (s?.goToIndex) s.goToIndex(byIndex);\n}\n\nfunction ensurePagerHost(): HTMLDivElement | null {\n  const scrubber = document.querySelector('.DiscussionPage .PostStreamScrubber');\n  if (!scrubber) return null;\n\n  let host = scrubber.parentElement?.querySelector(':scope > .MagicRead-TimelinePagerHost') as HTMLDivElement | null;\n\n  if (!host) {\n    host = document.createElement('div');\n    host.className = 'MagicRead-TimelinePagerHost';\n    scrubber.insertAdjacentElement('afterend', host);\n  }\n  return host;\n}\n\nfunction digits(n: string | number): number {\n  let v = parseInt(String(n), 10);\n  if (isNaN(v) || v < 0) v = 0;\n  return String(v).length;\n}\n\nfunction fitWidth(el: HTMLElement, n: string | number, padCh = 0): void {\n  const ch = digits(n) + padCh;\n  el.setAttribute('style', `width:${ch}ch`);\n}\n\nfunction buildPagerDom(host: HTMLDivElement): () => void {\n  host.textContent = '';\n\n  const wrap = document.createElement('div');\n  wrap.className = 'MagicRead-TimelinePager';\n\n  const input = document.createElement('input');\n  input.type = 'text';\n  input.inputMode = 'numeric';\n  input.autocomplete = 'off';\n  input.className = 'MagicRead-Input';\n\n  const sep = document.createElement('span');\n  sep.className = 'MagicRead-Sep';\n  sep.textContent = '/';\n\n  const total = document.createElement('span');\n  total.className = 'MagicRead-Total';\n\n  wrap.appendChild(input);\n  wrap.appendChild(sep);\n  wrap.appendChild(total);\n  host.appendChild(wrap);\n\n  function sanitize() {\n    const v = input.value.replace(/[^\\d]/g, '');\n    input.value = v;\n    fitWidth(input, v || 0, 0.5);\n  }\n\n  function commit() {\n    let v = input.value;\n    if (!v) v = '1';\n    gotoPage(v);\n  }\n\n  input.addEventListener('input', sanitize);\n  input.addEventListener('keydown', (e) => {\n    if ((e as KeyboardEvent).key === 'Enter') commit();\n  });\n  input.addEventListener('blur', commit);\n\n  function sync() {\n    const cur = currentPage();\n    const all = totalPages();\n    input.value = String(cur);\n    total.textContent = String(all);\n    fitWidth(input, cur, 0.5);\n    fitWidth(total, all, 0.5);\n  }\n\n  sync();\n  return sync;\n}\n\nfunction mountPager(): void {\n  if (!isDiscussionPage() || isMobile() || !paginationEnabled()) {\n    unmountPager();\n    return;\n  }\n\n  const host = ensurePagerHost();\n  if (!host) return;\n\n  pagerUpdate = buildPagerDom(host);\n\n  const streamNode = document.querySelector('.DiscussionPage .PostStream');\n  if (streamNode) {\n    if (mo) mo.disconnect();\n    mo = new MutationObserver(() => {\n      pagerUpdate?.();\n    });\n    mo.observe(streamNode, { childList: true, subtree: true });\n  }\n\n  if (!winListenersBound) {\n    window.addEventListener('popstate', handleRouteChange as any, { passive: true });\n    window.addEventListener('hashchange', handleRouteChange as any, { passive: true });\n    window.addEventListener('resize', handleResize as any, { passive: true });\n    winListenersBound = true;\n  }\n}\n\nfunction unmountPager(): void {\n  if (mo) {\n    mo.disconnect();\n    mo = null;\n  }\n  const host = document.querySelector('.MagicRead-TimelinePagerHost');\n  if (host?.parentNode) host.parentNode.removeChild(host);\n  pagerUpdate = null;\n}\n\nfunction handleRouteChange(): void {\n  if (routeTimer) window.clearTimeout(routeTimer);\n  routeTimer = window.setTimeout(() => {\n    if (!isDiscussionPage() || isMobile() || !paginationEnabled()) {\n      unmountPager();\n    } else {\n      mountPager();\n      pagerUpdate?.();\n    }\n  }, 60);\n}\n\nfunction handleResize(): void {\n  if (resizeTimer) window.clearTimeout(resizeTimer);\n  resizeTimer = window.setTimeout(() => handleRouteChange(), 120);\n}\n\napp.initializers.add('capybash-magicread', () => {\n  // === COUNTER ===\n  function counterEnabled(): boolean {\n    const v = app.forum.attribute('magicread_enable_counter');\n    return v !== false;\n  }\n\n  const oldCreate = TextEditor.prototype.oncreate;\n  TextEditor.prototype.oncreate = function (this: MagicReadEditor, vnode: any) {\n    if (oldCreate) oldCreate.call(this, vnode);\n    if (!counterEnabled()) return;\n\n    this.magicReadCounterEl = mountCounterLeft(this);\n\n    this.magicReadUpdate = () => {\n      const ta = getTextarea(this);\n      const val = ta?.value?.length ?? 0;\n      if (this.magicReadCounterEl) this.magicReadCounterEl.textContent = String(val);\n    };\n\n    const ta = getTextarea(this);\n    if (ta) {\n      ta.addEventListener('input', this.magicReadUpdate);\n      this.magicReadUpdate();\n    }\n  };\n\n  const oldUpdate = TextEditor.prototype.onupdate;\n  TextEditor.prototype.onupdate = function (this: MagicReadEditor, vnode: any) {\n    if (oldUpdate) oldUpdate.call(this, vnode);\n    if (!counterEnabled()) return;\n\n    if (!this.magicReadCounterEl || !document.body.contains(this.magicReadCounterEl)) {\n      this.magicReadCounterEl = mountCounterLeft(this);\n      this.magicReadUpdate?.();\n    }\n  };\n\n  const oldRemove = TextEditor.prototype.onremove;\n  TextEditor.prototype.onremove = function (this: MagicReadEditor, vnode: any) {\n    try {\n      const ta = getTextarea(this);\n      if (ta && this.magicReadUpdate) ta.removeEventListener('input', this.magicReadUpdate);\n      const li = this.magicReadCounterEl?.closest('.item-magicread-counter');\n      if (li?.parentNode) li.parentNode.removeChild(li);\n    } catch {}\n    if (oldRemove) oldRemove.call(this, vnode);\n  };\n\n  extend(DiscussionPage.prototype, 'oncreate', function () {\n    setTimeout(handleRouteChange, 0);\n  });\n\n  extend(DiscussionPage.prototype, 'onupdate', function () {\n    if (pagerUpdate) pagerUpdate();\n    else handleRouteChange();\n  });\n\n  extend(DiscussionPage.prototype, 'onremove', function () {\n    unmountPager();\n  });\n\n  window.addEventListener('popstate', handleRouteChange as any, { passive: true });\n  window.addEventListener('hashchange', handleRouteChange as any, { passive: true });\n  window.addEventListener('resize', handleResize as any, { passive: true });\n});"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","getTextarea","ctx","_ctx$attrs","attrs","composer","editor","el","mountCounterLeft","ta","closest","controls","querySelector","li","span","nodes","document","createElement","className","textContent","setAttribute","appendChild","createCounterLi","insertAdjacentElement","pagerUpdate","mo","routeTimer","resizeTimer","winListenersBound","isDiscussionPage","isMobile","window","matchMedia","matches","paginationEnabled","app","attribute","getStream","s","stream","__stream","totalPages","total","commentCount","pages","Math","ceil","fitWidth","n","padCh","ch","v","parseInt","String","isNaN","length","digits","mountPager","host","_scrubber$parentEleme","scrubber","parentElement","ensurePagerHost","wrap","input","type","inputMode","autocomplete","sep","commit","value","all","num","byIndex","byNumber","goToNumber","goToIndex","gotoPage","sync","idx","p","cur","index","floor","addEventListener","replace","e","buildPagerDom","streamNode","disconnect","MutationObserver","observe","childList","subtree","handleRouteChange","passive","handleResize","unmountPager","parentNode","removeChild","clearTimeout","setTimeout","add","counterEnabled","oldCreate","TextEditor","oncreate","vnode","_this","this","magicReadCounterEl","magicReadUpdate","_ta$value$length","_ta$value","val","oldUpdate","onupdate","_this$magicReadUpdate","body","contains","oldRemove","onremove","_this$magicReadCounte","removeEventListener","_unused","extend","DiscussionPage"],"sourceRoot":""}